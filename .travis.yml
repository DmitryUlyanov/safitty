group: travis_latest
language: python
cache: pip
python:
  - 3.6

stages:
  - Codestyle
  - Test
  - Deploy

install: &requirements
  pip install -r requirements.txt

jobs:
  include:
  - stage: Codestyle
    install: pip install flake8
    script:
      - flake8 . --count --ignore=E126,E226,E704,E731,W503,W504,F405 --max-complexity=16
        --show-source --statistics --max-line-length=120

  - stage: Test
    install:
      - *requirements
      - pip install pytest
    script:
      - py.test tests/

  - stage: Deploy
    script: true
    deploy:
      provider: pypi
      user: "$PYPI_USER"
      password:
        secure: CKT3U6ogO11rxFpjsv+i4cdXbVgCOwx3Lcv9MApu8wWKvf18tLkGt4ylrJrgCb+XQgJi47jA+EeWKX8xHkX5yeNHxAOJqCSGXQft/wK6Ucqah2jTt56RC8mTZ7V7gU+s/tN4D46YPRJfkVq7PggnrLGT+Zo3SdHh6rZwOwBX575SfC5IhoeApoaYPVuMjhZh9sJy79G6ekXcQ1MUMxi/tbW1JQ1xyoDu1Rld1iR8RG7qtVkVuROa41bOKpisWgW9PH5dM5SiX/ahA6y0XXbqHwjnystR8DODzzzy8PQ+iVKVqwdOAU4W1DRhzs/fUO5g8GrvDJU0facvYWV7xt/xx/6pxtjDMqlokQCK8jiglSqXwdr5KRdJZ3sosaqFGiKMFrWdyBHK3disEvrgPui2gItRjqQqM0y2Qi5EteGBbVQws1oMND4rpCiT0AaWTqXPTqPbztN+sHSVeJdEe8AnOAHBcES8lVtdx3h9rDQd3YneSm1L0JkWYZxy+Ke65yC7yiu1PuSEywg+ykweCmNeAfZX0B4Qn+QFr5qkn+IY30asxKnElAUr0oKKSL3K60vsks9mlikXMWIU9ME3uDEhtnOWJ5K0UAmmgDtu0JLiYsmQ/Ann4Z1rxPPGEdclpSO6N1UVfw+eQ/fRy5AktsU8i8fIqKbuHTgtDaKNbAfMlb0=
      skip_cleanup: true
      distributions: sdist bdist_wheel
      on:
        tags: true
